---
// src/pages/elements.astro
// cette page servira à tester tous les components
import BaseLayout from '@layouts/BaseLayout.astro';
import BlogCard from '@components/blog/BlogCard.astro';
import config from '@config/siteConfig';
import { getSinglePage } from "@/utils/contentParser.astro";
import { getAllTaxonomy, getTaxonomy } from "@/utils/taxonomyParser.astro";
import { sortByDate } from "@/utils/sortFunctions";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";

const BLOG_FOLDER = "blog";

const postIndex = (await getEntry(
  BLOG_FOLDER,
  "-index"
)) as CollectionEntry<"blog">;
const posts = await getSinglePage(BLOG_FOLDER);
const allCategories = await getAllTaxonomy(BLOG_FOLDER, "categories");
const categories = await getTaxonomy(BLOG_FOLDER, "categories");
const tags = await getTaxonomy(BLOG_FOLDER, "tags");
const sortedPosts = sortByDate(posts);
const totalPages: number = Math.ceil(posts.length / config.settings.pagination);
const currentPosts = sortedPosts.slice(0, config.settings.pagination);


// Fonction pour générer les numéros de pagination
const generatePaginationNumbers = (max: number = 32): number[] => {
  return Array.from({ length: max }, (_, i) => i + 1);
};

const paginationNumbers = generatePaginationNumbers(32);
---

<BaseLayout title="elements">
  <!-- Section Blog Cards -->
  <section class="mt-16 mb-12">
    <h2 class="text-3xl font-bold text-center mb-8">Les cartes de blog</h2>
    <div class="flex flex-wrap justify-center gap-6">
      {
        currentPosts.map((post) => (
          <div class="mb-14 md:col-6">
              <BlogCard data={post} />
          </div>
        ))
      }
    </div>
  </section> 
  <!-- Section Pagination -->
  <section class="mt-16 mb-12">
    <h2 class="text-3xl font-bold text-center mb-8">La Pagination</h2>
    <div class="join">
      {
        paginationNumbers.map((num, index) => (
          <input
            class="join-item btn btn-square"
            type="radio"
            name="options"
            aria-label={num.toString()}
            checked={index === 0 ? "checked" : undefined}
          />
        ))
      }
    </div>  
  </section>
</BaseLayout>
