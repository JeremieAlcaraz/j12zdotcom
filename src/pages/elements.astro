---
// src/pages/elements.astro
// cette page servira à tester tous les components
import BaseLayout from '@layouts/BaseLayout.astro';
import BlogCard from '@components/blog/BlogCard.astro';
import Pagination from '@components/blog/Pagination.astro';
import config from '@config/siteConfig';
import { getSinglePage } from "@/utils/contentParser.astro";
import { getAllTaxonomy, getTaxonomy } from "@/utils/taxonomyParser.astro";
import { sortByDate } from "@/utils/sortFunctions";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";

const BLOG_FOLDER = "blog";
const postIndex = (await getEntry(
  BLOG_FOLDER,
  "-index"
)) as CollectionEntry<"blog">;
const posts = await getSinglePage(BLOG_FOLDER);
const allCategories = await getAllTaxonomy(BLOG_FOLDER, "categories");
const categories = await getTaxonomy(BLOG_FOLDER, "categories");
const tags = await getTaxonomy(BLOG_FOLDER, "tags");
const sortedPosts = sortByDate(posts);
const totalPages: number = Math.ceil(posts.length / config.settings.pagination);
const currentPosts = sortedPosts.slice(0, config.settings.pagination);
const currentPage = 1; // Pour l'exemple, on peut aussi récupérer depuis l'URL

// Debug - à supprimer après
console.log('Posts length:', posts.length);
console.log('Pagination setting:', config.settings.pagination);
console.log('Total pages:', totalPages);
console.log('Config object:', config);
---

<BaseLayout title="elements">
  <!-- Section Blog Cards -->
  <section class="mt-16 mb-12">
    <h2 class="text-3xl font-bold text-center mb-8">Les cartes de blog</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6 mb-8">
      {
        currentPosts.map((post) => (
          <div class="w-full">
            <BlogCard data={post} />
          </div>
        ))
      }
    </div>
  </section> 

  <!-- Section Pagination -->
  <section class="mt-16 mb-12">
    <h2 class="text-3xl font-bold text-center mb-8">La Pagination</h2>
    <div class="flex justify-center">
      <Pagination 
        section='blog'
        totalPages={Math.max(totalPages, 5)}
        currentPage={currentPage}
      />
    </div>
  </section>
</BaseLayout>
