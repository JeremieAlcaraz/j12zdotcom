---
import ImageMod from './ImageMod.astro'

interface Props {
  /** URL externe ou chemin local (ex: "images/hero" pour src/assets) */
  src: string
  alt: string
  /** Légende optionnelle affichée sous l'image */
  caption?: string
  /** Variante de style */
  variant?: 'default' | 'elevated' | 'bordered' | 'full' | 'rounded'
  /** Largeur de l'image (obligatoire pour images locales) */
  width?: number
  /** Hauteur de l'image (obligatoire pour images locales) */
  height?: number
  /** Chargement lazy par défaut */
  loading?: 'eager' | 'lazy'
  /** Classes CSS additionnelles */
  class?: string
}

const {
  src,
  alt,
  caption,
  variant = 'default',
  width,
  height,
  loading = 'lazy',
  class: className = '',
} = Astro.props

// Détection si l'image est externe (URL) ou locale
const isExternalImage = src.startsWith('http://') || src.startsWith('https://')

// Styles de variantes
const variantStyles = {
  default: 'rounded-lg shadow-sm',
  elevated: 'rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300',
  bordered: 'rounded-lg border-2 border-gray-200 dark:border-gray-700',
  full: 'rounded-none shadow-none',
  rounded: 'rounded-2xl shadow-md',
}

const figureClasses = {
  default: 'my-8',
  elevated: 'my-8',
  bordered: 'my-8',
  full: 'my-6 -mx-4 sm:mx-0',
  rounded: 'my-8',
}

const imageClasses = `${variantStyles[variant]} ${className} w-full h-auto`
---

<figure class={figureClasses[variant]}>
  {
    isExternalImage ? (
      <img
        src={src}
        alt={alt}
        loading={loading}
        class={imageClasses}
        width={width}
        height={height}
      />
    ) : (
      <ImageMod
        src={src}
        alt={alt}
        width={width!}
        height={height!}
        loading={loading}
        class={imageClasses}
      />
    )
  }
  {
    caption && (
      <figcaption class="mt-3 text-sm text-gray-600 dark:text-gray-400 text-center italic">
        {caption}
      </figcaption>
    )
  }
</figure>
