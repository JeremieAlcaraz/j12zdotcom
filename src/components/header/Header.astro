---
// ==========================================
// SECTION FRONTMATTER (CÔTÉ SERVEUR)
// ==========================================
// Cette section s'exécute côté serveur lors du build
// Elle permet d'importer des modules et de traiter les props

// ✅ IMPORTS - Importation des types et configurations
import type { NavbarProps } from '@components/header'; // Type TypeScript pour les props du composant
import { defaultLogo, defaultLinks } from '@config/navigation'; // Valeurs par défaut pour logo et liens

// ✅ DESTRUCTURATION DES PROPS avec valeurs par défaut
// Astro.props contient toutes les propriétés passées au composant
// On utilise la destructuration avec des valeurs par défaut si rien n'est fourni
const { logo = defaultLogo, links = defaultLinks } = Astro.props as NavbarProps;



---

<!-- ==========================================
     SECTION TEMPLATE (HTML + COMPOSANTS)
     ========================================== --><!-- Cette section définit la structure HTML du composant --><!-- CONTENEUR PRINCIPAL DE LA NAVBAR --><!-- Utilise les classes DaisyUI pour le styling (navbar, bg-base-100, shadow-md) -->
<nav class="navbar bg-base-100 shadow-md">
  <!-- PARTIE GAUCHE DE LA NAVBAR (logo + nom) -->
  <div class="navbar-start">
    <!-- LIEN LOGO - Retour à l'accueil -->
    <!-- btn-ghost = bouton transparent, text-xl = taille de texte, normal-case = pas de transformation de casse -->
    <a href="/" class="btn btn-ghost text-xl normal-case">
      <!-- IMAGE DU LOGO -->
      <!-- {logo} = variable JavaScript injectée dans l'HTML -->
      <!-- h-12 pour augmenter la hauteur, w-auto pour conserver le ratio -->
      <img src={logo} alt="Logo" class="h-12 w-auto" />
      <!-- TEXTE DU LOGO -->
      <!-- hidden sm:inline = caché sur mobile, visible sur écrans >= sm, ml-2 = marge gauche -->
      <span class="hidden sm:inline ml-2">Jérémie Alcaraz</span>
    </a>
  </div>

    <!-- PARTIE CENTRALE DE LA NAVBAR (navigation principale) -->
  <!-- hidden lg:flex = caché sur mobile/tablet, visible sur écrans ≥ lg -->
  <div class="navbar-center hidden lg:flex overflow-visible">
    <!-- LISTE DE NAVIGATION HORIZONTALE -->
    <!-- overflow-visible pour que le dropdown ne soit pas coupé -->
    <ul class="menu menu-horizontal px-1 overflow-visible">
      {
        /* BOUCLE JAVASCRIPT pour générer les liens de navigation */
        links.map(({ href, label }) => (
          label !== 'Formations' ? (
            <li>
              <!-- LIEN DE NAVIGATION SIMPLE -->
              <a href={href}
                 class="hover:bg-primary hover:text-primary-content rounded-lg">
                {label}
              </a>
            </li>
          ) : (
            /* Dropdown “Formations” */
            <li
              class="relative dropdown dropdown-hover"  
              tabindex="0"
            >
              <a class="hover:bg-primary hover:text-primary-content rounded-lg flex items-center">
                Formations
                <!-- flèche vers le bas -->
                <svg class="ml-1 w-4 h-4 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 9l-7 7-7-7" />
                </svg>
              </a>
              <!--
                mt-0         → pas de gap top
                -mt-1        → décale le menu de 0.25rem vers le haut pour supprimer tout trou
                z-50         → au-dessus de tout
              -->
              <ul class="dropdown-content menu p-2 bg-base-100 rounded-box w-52 shadow-lg mt-0 z-50">
                <li><a class="hover:bg-secondary hover:text-primary-content rounded-lg" href="/formations/formation-1">Formation 1</a></li>
                <li><a class="hover:bg-primary hover:text-primary-content rounded-lg" href="/formations/formation-2">Formation 2</a></li>
                <li><a class="hover:bg-secondary hover:text-primary-content rounded-lg" href="/formations/formation-3">Formation 3</a></li>
              </ul>
            </li>
          )
        ))
      }
    </ul>
  </div>




  <!-- PARTIE DROITE DE LA NAVBAR (bouton thème + menu mobile) -->
  <div class="navbar-end">
    <!-- BOUTON DE CHANGEMENT DE THÈME -->
    <!-- btn-circle = bouton rond, id pour le ciblage JavaScript -->
    <button id="theme-toggle" class="btn btn-ghost btn-circle">
      <!-- ICÔNE SOLEIL (thème clair) -->
      <!-- SVG avec path défini pour dessiner un soleil -->
      <svg
        id="sun-icon"
        class="w-5 h-5 fill-current"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
      >
        <path
          d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"
        ></path>
      </svg>

      <!-- ICÔNE LUNE (thème sombre) -->
      <!-- hidden par défaut, sera affichée/cachée via JavaScript -->
      <svg
        id="moon-icon"
        class="w-5 h-5 fill-current hidden"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
      >
        <path
          d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"
        ></path>
      </svg>
    </button>

    <!-- MENU MOBILE (hamburger menu) -->
    <!-- dropdown-end = alignement à droite, lg:hidden = caché sur grands écrans -->
    <div class="dropdown dropdown-end lg:hidden">
      <!-- BOUTON HAMBURGER (3 lignes) -->
      <!-- tabindex="0" = rend l'élément focusable au clavier -->
      <label tabindex="0" class="btn btn-ghost btn-circle">
        <!-- ICÔNE HAMBURGER (3 lignes horizontales) -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <!-- Path SVG pour dessiner les 3 lignes du menu hamburger -->
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h8m-8 6h16"
          >
          </path>
        </svg>
      </label>

      <!-- CONTENU DU DROPDOWN (menu déroulant mobile) -->
      <!-- menu-sm = petite taille, dropdown-content = contenu du dropdown -->
      <!-- mt-3 = marge top, z-[1] = z-index pour être au-dessus, p-2 = padding -->
      <!-- shadow = ombre, bg-base-100 = couleur de fond, rounded-box = coins arrondis -->
      <ul
        tabindex="0"
        class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52"
      >
        {
          /* MÊME BOUCLE que pour le menu desktop mais sans styling hover spécial */
          links.map(({ href, label }) => (
            <li>
              <a href={href}>{label}</a>
            </li>
          ))
        }
      </ul>
    </div>
  </div>
</nav>



<!-- ==========================================
     SECTION SCRIPT JAVASCRIPT CLIENT
     ========================================== -->
<script>
  // ==========================================
  // CONSTANTES ET UTILITAIRES
  // ==========================================

  // CLÉ pour stocker le thème dans localStorage du navigateur
  const THEME_STORAGE_KEY = 'theme';

  // FONCTION UTILITAIRE : vérifie si le thème actuel est sombre
  // Lit l'attribut 'data-theme' sur l'élément <html>
  const isDark = () => document.documentElement.getAttribute('data-theme') === 'dark';

  // ==========================================
  // FONCTION DE MISE À JOUR DU THÈME
  // ==========================================

  // APPLIQUE le thème (sombre ou clair) à la page
  const updateTheme = (isDarkValue: boolean) => {
    // CHANGE l'attribut data-theme sur <html> pour appliquer le thème
    // 'dark' ou 'douceurLight' (thème personnalisé clair)
    document.documentElement.setAttribute('data-theme', isDarkValue ? 'dark' : 'douceurLight');

    // RÉCUPÈRE les éléments des icônes soleil et lune
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');

    // AFFICHE/CACHE les icônes selon le thème
    if (sunIcon && moonIcon) {
      // Si thème sombre : cache soleil, montre lune
      // Si thème clair : montre soleil, cache lune
      sunIcon.classList.toggle('hidden', isDarkValue); // Cache si sombre
      moonIcon.classList.toggle('hidden', !isDarkValue); // Cache si clair
    }
  };

  // ==========================================
  // FONCTION D'INITIALISATION DU THÈME
  // ==========================================

  // CONFIGURE le thème initial au chargement de la page
  const setupTheme = () => {
    // RÉCUPÈRE le thème sauvegardé depuis localStorage
    const savedTheme = localStorage.getItem(THEME_STORAGE_KEY);

    // DÉTECTE la préférence système de l'utilisateur (sombre/clair)
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    // DÉTERMINE le thème initial :
    // 1. Si thème sauvegardé : utilise celui-ci
    // 2. Sinon : utilise la préférence système
    const initialThemeIsDark = savedTheme ? savedTheme === 'dark' : prefersDark;

    // APPLIQUE le thème déterminé
    updateTheme(initialThemeIsDark);
  };

  // ==========================================
  // FONCTION DE BASCULEMENT DU THÈME
  // ==========================================

  // GÈRE le clic sur le bouton de changement de thème
  const toggleTheme = (event: MouseEvent) => {
    // VÉRIFIE si les transitions visuelles sont supportées et activées
    // document.startViewTransition = API expérimentale pour les transitions
    // prefers-reduced-motion = préférence utilisateur pour réduire les animations
    const isAppearanceTransition =
      // @ts-expect-error: L'API View Transitions est expérimentale
      document.startViewTransition &&
      !window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // CAS SIMPLE : pas de transition animée
    if (!isAppearanceTransition) {
      const newThemeIsDark = !isDark(); // Inverse le thème actuel
      updateTheme(newThemeIsDark); // Applique le nouveau thème
      // SAUVEGARDE dans localStorage pour persistance
      localStorage.setItem(THEME_STORAGE_KEY, newThemeIsDark ? 'dark' : 'douceurLight');
      return;
    }

    // ==========================================
    // TRANSITION ANIMÉE (cercle qui s'agrandit)
    // ==========================================

    // RÉCUPÈRE les coordonnées du clic de souris
    const x = event.clientX;
    const y = event.clientY;

    // CALCULE le rayon nécessaire pour couvrir tout l'écran
    // Math.hypot = calcule la distance euclidienne
    // On prend la plus grande distance depuis le point de clic jusqu'aux coins
    const endRadius = Math.hypot(
      Math.max(x, window.innerWidth - x), // Distance horizontale max
      Math.max(y, window.innerHeight - y) // Distance verticale max
    );

    // DÉMARRE la transition avec l'API View Transitions
    const transition = document.startViewTransition(() => {
      const newThemeIsDark = !isDark(); // Inverse le thème
      updateTheme(newThemeIsDark); // Applique le changement
      // SAUVEGARDE le nouveau thème
      localStorage.setItem(THEME_STORAGE_KEY, newThemeIsDark ? 'dark' : 'douceurLight');
    });

    // ANIME la transition une fois qu'elle est prête
    transition.ready.then(() => {
      // DÉFINIT les keyframes de l'animation : cercle qui grandit
      const clipPath = [`circle(0px at ${x}px ${y}px)`, `circle(${endRadius}px at ${x}px ${y}px)`];

      // LANCE l'animation sur la nouvelle vue qui apparaît
      document.documentElement.animate(
        {
          clipPath: clipPath, // Animation du cercle qui s'agrandit
        },
        {
          duration: 500, // Durée : 500ms
          easing: 'ease-in-out', // Courbe d'animation
          pseudoElement: '::view-transition-new(root)', // Cible la nouvelle vue
        }
      );
    });
  };

  // ==========================================
  // INITIALISATION AU CHARGEMENT
  // ==========================================

  // CONFIGURE le thème dès que le script se charge
  setupTheme();

  // ATTACHE l'événement de clic au bouton de changement de thème
  // ?. = optional chaining (évite l'erreur si l'élément n'existe pas)
  document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);
</script>


<!-- ==========================================
     SECTION STYLES GLOBAUX
     ========================================== -->
<!-- is:global = applique les styles globalement (pas seulement à ce composant) -->
<style is:global>
  /* DÉSACTIVATION DES ANIMATIONS DE TRANSITION PAR DÉFAUT */
  /* Ces règles CSS ciblent les pseudo-éléments de l'API View Transitions */
  /* ::view-transition-old(root) = ancienne vue lors de la transition */
  /* ::view-transition-new(root) = nouvelle vue lors de la transition */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation: none; /* Supprime l'animation par défaut */
    mix-blend-mode: normal; /* Mode de mélange normal (pas de fusion de couleurs) */
  }

     /* --- FIX GAP DES DROPDOWNS NAVBAR -------------------------- */
  /* On enlève 1 px au margin-top auto-généré par DaisyUI        */
  /* pour que le sous-menu touche exactement le lien parent      */
    nav.navbar .dropdown > .dropdown-content {
    margin-top: -0.5px; /* colle le menu, plus aucun trou */
  }

</style>
