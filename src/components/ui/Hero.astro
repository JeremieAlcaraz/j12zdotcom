---
import Halo from '@components/ui/Halo.astro';
import ImageMod from '@components/common/ImageMod/ImageMod.astro';
import Container from '@components/ui/Container.astro';
import { markdownify } from '@/utils/textConverter';
import type { Button, Feature } from '@/types';
import type { CollectionEntry } from 'astro:content';
import { getEntry } from 'astro:content';

interface Homepage {
  banner: { title: string; content: string; image: string; button: Button };
  features: Feature[];
}

// Récupération des données
const homepage = await getEntry('homepage', 'index');
console.log('Homepage result:', homepage);

if (!homepage) {
  throw new Error('Homepage entry not found! Check src/content/homepage/index.md');
}

const { banner } = homepage.data as Homepage;
---

<!-- Hero optimisé avec Tailwind CSS v4 + DaisyUI v5 -->
<section class="w-full min-h-[max(85vh,500px)] flex items-center py-8 lg:py-16">
  <Container
    as="div"
    class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-[2fr_3fr] gap-8 lg:gap-16 items-stretch min-h-[400px]"
  >
    <!-- COLONNE IMAGE avec Halo -->
    <div class="flex justify-center items-center p-4 lg:p-8 order-1 lg:order-1">
      <div class="relative w-64 h-64 md:w-80 md:h-80 lg:w-96 lg:h-96 flex-shrink-0">
        <Halo />
        {
          banner.image && (
            <div class="absolute inset-0 flex items-center justify-center z-10">
              <div class="w-full h-full rounded-full overflow-hidden shadow-2xl">
                <ImageMod
                  src={banner.image}
                  width={600}
                  height={600}
                  alt="Portrait de Jérémie"
                  format="webp"
                  class="object-cover w-full h-full"
                />
              </div>
            </div>
          )
        }
      </div>
    </div>

    <!-- COLONNE TEXTE -->
    <div class="flex items-center justify-center lg:justify-start p-4 lg:p-8 order-2 lg:order-2">
      <div
        class="flex flex-col gap-6 lg:gap-8 w-full h-full justify-center text-center lg:text-left pr-0 lg:pr-4"
      >
        <h1
          set:html={markdownify(banner.title)}
          class="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight m-0"
        />
        <p
          set:html={markdownify(banner.content)}
          class="text-base md:text-lg lg:text-xl leading-relaxed m-0"
        />

        {
          banner.button.enable && (
            <div class="flex justify-center lg:justify-start mt-4">
              <a
                href={banner.button.link}
                target={banner.button.link.startsWith('http') ? '_blank' : '_self'}
                rel="noopener"
                class="btn btn-primary btn-lg"
              >
                {banner.button.label}
              </a>
            </div>
          )
        }
      </div>
    </div>
  </Container>
</section>
