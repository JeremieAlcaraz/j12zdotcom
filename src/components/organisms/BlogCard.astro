---
import { FaRegUserCircle } from 'react-icons/fa'
import type { CollectionEntry } from 'astro:content'

import config from '@/config/siteConfig'
import dateFormat from '@/utils/dateFormat'
import { humanize, slugify, smartTruncate } from '@/utils/textConverter'
import ImageMod from '@/components/atoms/ImageMod.astro'


const { summaryLength, blogFolder }: { summaryLength: number; blogFolder: string } = config.settings

interface Props {
  data: CollectionEntry<'blog'>
  base?: 100 | 200 | 300
}

const { data, base = 100 } = Astro.props

const { title, image, date, author } = data.data
const baseClasses = {
  100: 'bg-base-100',
  200: 'bg-base-200',
  300: 'bg-base-300',
} as const
---

<!-- Carte responsive avec hauteur uniforme -->
<div class={`card ${baseClasses[base]} flex h-full flex-col shadow-sm`}>
  <figure class="flex-shrink-0">
    {
      image && (
        <ImageMod
          class="h-48 w-full object-cover"
          src={image}
          alt={title}
          width={445}
          height={230}
          format="webp"
        />
      )
    }
  </figure>

  <!-- Corps de la carte avec flex-grow pour prendre l'espace restant -->
  <div class="card-body flex flex-grow flex-col">
    <!-- Titre avec lien -->
    <h2 class="card-title mb-3 text-lg leading-tight">
      <a href={`/${blogFolder}/${data.id}`} class="link link-hover line-clamp-2">
        {title}
      </a>
    </h2>

    <!-- Métadonnées -->
    <div class="mb-3 flex flex-wrap items-center gap-3 text-sm opacity-70">
      <!-- Auteur -->
      <div class="flex items-center gap-1.5">
        <FaRegUserCircle className="shrink-0 text-xs" />
        <a href={`/authors/${slugify(author)}`} class="link link-hover text-xs">
          {humanize(author)}
        </a>
      </div>

      <!-- Date -->
      <time datetime={date} class="text-xs">
        {dateFormat(date)}
      </time>
    </div>

    <!-- Résumé - prend l'espace restant -->
    <div class="flex-grow">
      <p class="text-base-content/70 line-clamp-3 text-sm leading-relaxed">
        {smartTruncate(data.body || '', summaryLength || 150)}
      </p>
    </div>

    <!-- Actions - toujours en bas -->
    <div class="card-actions mt-4 justify-end pt-3">
      <a href={`/${blogFolder}/${data.id}`} class="btn btn-primary btn-sm"> Lire la suite </a>
    </div>
  </div>
</div>
