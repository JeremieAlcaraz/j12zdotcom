---
import Halo from '@ui/atoms/Halo.astro'
import ImageMod from '@ui/atoms/ImageMod.astro'
import { markdownify } from '@/utils/textConverter'
import type { Button, Feature } from '@/types'
import { getEntry } from 'astro:content'

interface Homepage {
  banner: { title: string; content: string; image: string; button: Button }
  features: Feature[]
}

// Récupération des données
const homepage = await getEntry('homepage', 'index')
console.log('Homepage result:', homepage)

if (!homepage) {
  throw new Error('Homepage entry not found! Check src/content/homepage/index.md')
}

const { banner } = homepage.data as Homepage
---

<!-- Hero optimisé avec Tailwind CSS v4 + DaisyUI v5 -->
<section
  class="flex min-h-[max(85vh,500px)] items-center justify-center px-4 py-8 lg:px-8 lg:py-16"
>
  <div
    class="grid min-h-[400px] w-full max-w-7xl grid-cols-1 items-stretch gap-8 lg:grid-cols-[2fr_3fr] lg:gap-16"
  >
    <!-- COLONNE IMAGE avec Halo -->
    <div class="order-1 flex items-center justify-center p-4 lg:order-1 lg:p-8">
      <div class="relative h-64 w-64 flex-shrink-0 md:h-80 md:w-80 lg:h-96 lg:w-96">
        <Halo />
        {
          banner.image && (
            <div class="absolute inset-0 z-10 flex items-center justify-center">
              <div class="h-full w-full overflow-hidden rounded-full shadow-2xl">
                <ImageMod
                  src={banner.image}
                  width={600}
                  height={600}
                  alt="Portrait de Jérémie"
                  format="webp"
                  class="h-full w-full object-cover"
                />
              </div>
            </div>
          )
        }
      </div>
    </div>

    <!-- COLONNE TEXTE -->
    <div class="order-2 flex items-center justify-center p-4 lg:order-2 lg:justify-start lg:p-8">
      <div
        class="flex h-full w-full flex-col justify-center gap-6 pr-0 text-center lg:gap-8 lg:pr-4 lg:text-left"
      >
        <h1
          set:html={markdownify(banner.title)}
          class="m-0 text-4xl leading-tight font-bold md:text-5xl lg:text-6xl"
        />
        <p
          set:html={markdownify(banner.content)}
          class="m-0 text-base leading-relaxed md:text-lg lg:text-xl"
        />

        {
          banner.button.enable && (
            <div class="mt-4 flex justify-center lg:justify-start">
              <a
                href={banner.button.link}
                target={banner.button.link.startsWith('http') ? '_blank' : '_self'}
                rel="noopener"
                class="btn btn-primary btn-lg"
              >
                {banner.button.label}
              </a>
            </div>
          )
        }
      </div>
    </div>
  </div>
</section>

<style>
  /* CSS minimal - seulement pour les spécificités impossibles avec Tailwind */
  @media (max-width: 1023px) {
    .grid-cols-\[2fr_3fr\] {
      grid-template-columns: 1fr;
    }
  }
</style>
