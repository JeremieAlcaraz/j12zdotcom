---
import '@styles/index.css'
import Header from '@/layouts/SiteHeader.astro'
import Footer from '@/layouts/SiteFooter.astro'
import TwSizeIndicator from '@/domain/dev/TwSizeIndicator.astro'
import { ClientRouter } from 'astro:transitions'
const { title = 'Mon Site', meta_title, description, image } = Astro.props
const pageTitle = meta_title || title
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{pageTitle}</title>
    {description && <meta name="description" content={description} />}
    {image && <meta property="og:image" content={image} />}
    <meta property="og:title" content={pageTitle} />
    {description && <meta property="og:description" content={description} />}
    <meta name="twitter:title" content={pageTitle} />
    {description && <meta name="twitter:description" content={description} />}
    {image && <meta name="twitter:image" content={image} />}
    <ClientRouter />

    <script is:inline>
      function initTheme() {
        const THEME_STORAGE_KEY = 'theme'
        const savedTheme = localStorage.getItem(THEME_STORAGE_KEY)
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches
        const initialThemeIsDark = savedTheme ? savedTheme === 'dark' : prefersDark
        document.documentElement.setAttribute(
          'data-theme',
          initialThemeIsDark ? 'dark' : 'douceurLight'
        )
      }

      // Initialisation au chargement
      initTheme()

      // Réinitialisation après chaque navigation ViewTransition
      document.addEventListener('astro:after-swap', initTheme)
    </script>
  </head>

  <body class="min-h-screen">
    <!-- Layout principal avec Grid Tailwind -->
    <div class="grid min-h-screen grid-rows-[auto_1fr_auto]">
      <TwSizeIndicator />
      <!-- HEADER fixe -->
      <header class="fixed top-0 right-0 left-0 z-50 bg-transparent">
        <Header />
      </header>

      <!-- MAIN avec Hero full-width -->
      <main class="overflow-x-hidden pt-16">
        <!-- Hero full-width -->
        <slot name="hero" />
        <!-- Contenu centré pour les autres sections -->
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <slot />
        </div>
      </main>

      <!-- FOOTER -->
      <footer class="mt-auto">
        <Footer />
      </footer>
    </div>
  </body>
</html>

<!-- CSS minimal - seulement pour les spécificités impossibles avec Tailwind -->
<style>
  /* Tailwind CSS v4 gère automatiquement le reset via @import "tailwindcss" */
  /* Plus besoin de reset manual ni de CSS custom pour le layout */

  /* Transition douce et fluide pour ViewTransitions */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 0.6s;
    animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  ::view-transition-old(root) {
    animation-name: fade-out-smooth;
  }

  ::view-transition-new(root) {
    animation-name: fade-in-smooth;
  }

  @keyframes fade-out-smooth {
    0% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }

  @keyframes fade-in-smooth {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
</style>
